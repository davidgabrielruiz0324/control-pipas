<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Suministro de Agua</title>
</head>
<body>

<h3>Registro de suministro</h3>

<form id="f">
<input type="hidden" id="id_cliente">

Estatus:<br>
<select id="estatus" onchange="litrosOnOff()">
  <option value="ENTREGADO">ENTREGADO</option>
  <option value="NO SE SURTIÓ">NO SE SURTIÓ</option>
</select><br><br>

Litros:<br>
<input type="number" id="litros" value="0"><br><br>

Pipa / Operador:<br>
<input type="text" id="operador" required><br><br>

<button>GUARDAR</button>
</form>

<script>
const p = new URLSearchParams(location.search);
document.getElementById("id_cliente").value = p.get("id");
function litrosOnOff(){
  const l = document.getElementById("litros");
  l.disabled = document.getElementById("estatus").value === "NO SE SURTIÓ";
  if (l.disabled) l.value = 0;
}
window.latitud = "";
window.longitud = "";

if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(pos => {
    window.latitud = pos.coords.latitude;
    window.longitud = pos.coords.longitude;
  });
}
document.getElementById("f").onsubmit = e => {
  e.preventDefault();
  fetch("https://script.google.com/macros/s/AKfycbyoOh37YEdw_q_-F25tq1jZRh82c_xSKx-L_JN_QySqUHs-6kO_2QKmZXr4DnA7y-XAmg/exec", {
    method: "POST",
  body: JSON.stringify({
    id: document.getElementById("id_cliente").value,
    estatus: estatus.value,
    litros: litros.value,
    operador: operador.value
    lat: window.latitud,
    lon: window.longitud
  })
})
.then(r => r.text())
.then(resp => {
  if (resp === "DUPLICADO") {
    alert("⚠️ Este cliente ya fue surtido hoy");
  } else {
    alert("✅ Registro guardado");
  }
});
  


